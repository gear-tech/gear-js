FROM node:16-alpine AS builder
MAINTAINER gear
WORKDIR /new-frontend
ARG REACT_APP_API_URL \
    REACT_APP_NODE_ADDRESS \
    REACT_APP_WASM_COMPILER_URL \
    REACT_APP_DEFAULT_NODES_URL \
    REACT_APP_HCAPTCHA_SITE_KEY \
    REACT_APP_DEFAULT_TRANSFER_BALANCE_VALUE \
    REACT_APP_RRT
ENV REACT_APP_API_URL=${REACT_APP_API_URL} \
    REACT_APP_NODE_ADDRESS=${REACT_APP_NODE_ADDRESS} \
    REACT_APP_WASM_COMPILER_URL=${REACT_APP_WASM_COMPILER_URL} \
    REACT_APP_DEFAULT_NODES_URL=${REACT_APP_DEFAULT_NODES_URL} \
    REACT_APP_HCAPTCHA_SITE_KEY=${REACT_APP_HCAPTCHA_SITE_KEY} \
    REACT_APP_DEFAULT_TRANSFER_BALANCE_VALUE=${REACT_APP_DEFAULT_TRANSFER_BALANCE_VALUE} \
    REACT_APP_RRT=''
COPY . /new-frontend
RUN npm install --force
RUN npm run build

FROM nginx:alpine
RUN rm -vf /usr/share/nginx/html/*
COPY --from=builder /new-frontend/build /usr/share/nginx/html
