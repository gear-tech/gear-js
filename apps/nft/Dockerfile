FROM node:16-alpine AS builder

ARG REACT_APP_NODE_ADDRESS  \
    REACT_APP_IPFS_ADDRESS  \
    REACT_APP_NFT_CONTRACT_ADDRESS  \
    REACT_APP_DAPPS_API_ADDRESS \
    REACT_APP_IPFS_GATEWAY_ADDRESS
ENV REACT_APP_NODE_ADDRESS=${REACT_APP_NODE_ADDRESS} \
    REACT_APP_IPFS_ADDRESS=${REACT_APP_IPFS_ADDRESS} \
    REACT_APP_NFT_CONTRACT_ADDRESS=${REACT_APP_NFT_CONTRACT_ADDRESS} \
    REACT_APP_DAPPS_API_ADDRESS=${REACT_APP_DAPPS_API_ADDRESS} \
    REACT_APP_IPFS_GATEWAY_ADDRESS=${REACT_APP_IPFS_GATEWAY_ADDRESS}

WORKDIR /src
COPY package.json .
COPY yarn.lock .
COPY tsconfig.json .
COPY .yarn .yarn
COPY .yarnrc.yml .
COPY ./apps/nft apps/nft

RUN yarn install
RUN yarn build:nft

FROM nginx:alpine
RUN rm -vf /usr/share/nginx/html/*
COPY --from=builder /src/apps/nft/build /usr/share/nginx/html
